From 4bc32818bdc4786626e0be80ad440c1792989672 Mon Sep 17 00:00:00 2001
From: Andarwinux <Andarwinux@users.noreply.github.com>
Date: Fri, 8 Dec 2023 00:00:00 +0000
Subject: [PATCH] vulkan: rebase patch

---
 ...1-cross-compile-static-linking-hacks.patch | 33 +++++++------------
 1 file changed, 12 insertions(+), 21 deletions(-)

diff --git a/packages/vulkan-0001-cross-compile-static-linking-hacks.patch b/packages/vulkan-0001-cross-compile-static-linking-hacks.patch
index 1a3f38800..86eb9530c 100644
--- a/packages/vulkan-0001-cross-compile-static-linking-hacks.patch
+++ b/packages/vulkan-0001-cross-compile-static-linking-hacks.patch
@@ -1,4 +1,4 @@
-From e5b9b6b03ef91618aebcd2c452c6078813f7bcb0 Mon Sep 17 00:00:00 2001
+From fb6cb98928fd783e11d011bae8ab563a6d8e9803 Mon Sep 17 00:00:00 2001
 From: shinchiro <shinchiro@users.noreply.github.com>
 Date: Wed, 29 Nov 2023 17:38:59 +0800
 Subject: [PATCH] loader: cross-compile & static linking hacks
@@ -7,14 +7,14 @@ Subject: [PATCH] loader: cross-compile & static linking hacks
  loader/CMakeLists.txt       | 24 ++++++------------------
  loader/loader.h             |  2 ++
  loader/loader.rc.in         |  4 ++++
- loader/loader_windows.c     |  4 ++++
+ loader/loader_windows.c     |  2 ++
  loader/vk_loader_platform.h |  9 +++------
  loader/vulkan_own.pc.in     | 11 +++++++++++
- 6 files changed, 30 insertions(+), 24 deletions(-)
+ 6 files changed, 28 insertions(+), 24 deletions(-)
  create mode 100644 loader/vulkan_own.pc.in
 
 diff --git a/loader/CMakeLists.txt b/loader/CMakeLists.txt
-index 39f4f6c..fa18832 100644
+index 39f4f6cf5..fa188322b 100644
 --- a/loader/CMakeLists.txt
 +++ b/loader/CMakeLists.txt
 @@ -21,8 +21,9 @@ include(CheckIncludeFile)
@@ -71,7 +71,7 @@ index 39f4f6c..fa18832 100644
      message(NOTICE "Apple STATIC lib: it will be built but not installed, and vulkan.pc and VulkanLoaderConfig.cmake won't be generated!")
      return()
 diff --git a/loader/loader.h b/loader/loader.h
-index 93346a9..6e3f867 100644
+index 6bd7115f4..90a441306 100644
 --- a/loader/loader.h
 +++ b/loader/loader.h
 @@ -33,7 +33,9 @@
@@ -85,7 +85,7 @@ index 93346a9..6e3f867 100644
  static inline VkPhysicalDevice loader_unwrap_physical_device(VkPhysicalDevice physicalDevice) {
      struct loader_physical_device_tramp *phys_dev = (struct loader_physical_device_tramp *)physicalDevice;
 diff --git a/loader/loader.rc.in b/loader/loader.rc.in
-index 0dc4227..e7fcea0 100644
+index 0dc4227da..e7fcea06f 100644
 --- a/loader/loader.rc.in
 +++ b/loader/loader.rc.in
 @@ -19,7 +19,11 @@
@@ -101,19 +101,10 @@ index 0dc4227..e7fcea0 100644
  // All set through CMake
  #define VER_FILE_VERSION ${LOADER_VER_FILE_VERSION}
 diff --git a/loader/loader_windows.c b/loader/loader_windows.c
-index ad65f9e..2de7d5f 100644
+index 5b0dfb0da..de6942a32 100644
 --- a/loader/loader_windows.c
 +++ b/loader/loader_windows.c
-@@ -47,6 +47,8 @@
- #include <strsafe.h>
- #if defined(__MINGW32__)
- #undef strcpy  // fix error with redfined strcpy when building with MinGW-w64
-+#define CM_GETIDLIST_FILTER_PRESENT            (0x00000100)
-+#define CM_GETIDLIST_FILTER_CLASS              (0x00000200)
- #endif
- #include <dxgi1_6.h>
- #include "adapters.h"
-@@ -95,6 +97,7 @@ void windows_initialization(void) {
+@@ -95,6 +95,7 @@ void windows_initialization(void) {
  #endif
  }
  
@@ -121,7 +112,7 @@ index ad65f9e..2de7d5f 100644
  BOOL WINAPI DllMain(HINSTANCE hinst, DWORD reason, LPVOID reserved) {
      (void)hinst;
      switch (reason) {
-@@ -112,6 +115,7 @@ BOOL WINAPI DllMain(HINSTANCE hinst, DWORD reason, LPVOID reserved) {
+@@ -112,6 +113,7 @@ BOOL WINAPI DllMain(HINSTANCE hinst, DWORD reason, LPVOID reserved) {
      }
      return TRUE;
  }
@@ -130,7 +121,7 @@ index ad65f9e..2de7d5f 100644
  bool windows_add_json_entry(const struct loader_instance *inst,
                              char **reg_data,    // list of JSON files
 diff --git a/loader/vk_loader_platform.h b/loader/vk_loader_platform.h
-index 1a84a7d..67848c6 100644
+index afb0f5634..72a908a0f 100644
 --- a/loader/vk_loader_platform.h
 +++ b/loader/vk_loader_platform.h
 @@ -69,15 +69,12 @@
@@ -162,7 +153,7 @@ index 1a84a7d..67848c6 100644
      assert(ctl != NULL);
 diff --git a/loader/vulkan_own.pc.in b/loader/vulkan_own.pc.in
 new file mode 100644
-index 0000000..ed2f30b
+index 000000000..ed2f30bb2
 --- /dev/null
 +++ b/loader/vulkan_own.pc.in
 @@ -0,0 +1,11 @@
@@ -178,5 +169,5 @@ index 0000000..ed2f30b
 +Libs.private: -lshlwapi -lcfgmgr32
 +Cflags: -I${includedir}
 -- 
-2.42.0
+2.43.0
 
