From 42820188b2c26504a24fae3c8858bd3b9fc6bce6 Mon Sep 17 00:00:00 2001
From: zhongfly <11155705+zhongfly@users.noreply.github.com>
Date: Mon, 31 Jul 2023 10:08:31 +0800
Subject: [PATCH] brotli: add missing version

---
 ...1-fix-missing-version-in-CMake-build.patch | 24 +++++++++++++++++++
 packages/brotli.cmake                         |  1 +
 2 files changed, 25 insertions(+)
 create mode 100644 packages/brotli-0001-fix-missing-version-in-CMake-build.patch

diff --git a/packages/brotli-0001-fix-missing-version-in-CMake-build.patch b/packages/brotli-0001-fix-missing-version-in-CMake-build.patch
new file mode 100644
index 0000000..118061b
--- /dev/null
+++ b/packages/brotli-0001-fix-missing-version-in-CMake-build.patch
@@ -0,0 +1,24 @@
+From 23f6edc3c3203c62d9fa9f32889265b771b07160 Mon Sep 17 00:00:00 2001
+From: zhongfly <11155705+zhongfly@users.noreply.github.com>
+Date: Mon, 31 Jul 2023 09:54:48 +0800
+Subject: [PATCH] fix missing version in CMake build
+
+---
+ CMakeLists.txt | 1 +
+ 1 file changed, 1 insertion(+)
+
+diff --git a/CMakeLists.txt b/CMakeLists.txt
+index bf5204d..61378cd 100644
+--- a/CMakeLists.txt
++++ b/CMakeLists.txt
+@@ -61,6 +61,7 @@ endfunction(read_macro)
+ read_macro("c/common/version.h" "BROTLI_VERSION_MAJOR" BROTLI_VERSION_MAJOR)
+ read_macro("c/common/version.h" "BROTLI_VERSION_MINOR" BROTLI_VERSION_MINOR)
+ read_macro("c/common/version.h" "BROTLI_VERSION_PATCH" BROTLI_VERSION_PATCH)
++set(BROTLI_VERSION "${BROTLI_VERSION_MAJOR}.${BROTLI_VERSION_MINOR}.${BROTLI_VERSION_PATCH}")
+ mark_as_advanced(BROTLI_VERSION BROTLI_VERSION_MAJOR BROTLI_VERSION_MINOR BROTLI_VERSION_PATCH)
+ 
+ # ABI Version information
+-- 
+2.41.0
+
diff --git a/packages/brotli.cmake b/packages/brotli.cmake
index c2156e1..48de1f2 100644
--- a/packages/brotli.cmake
+++ b/packages/brotli.cmake
@@ -4,6 +4,7 @@ ExternalProject_Add(brotli
     GIT_CLONE_FLAGS "--sparse --filter=tree:0"
     GIT_CLONE_POST_COMMAND "sparse-checkout set --no-cone /* !tests"
     UPDATE_COMMAND ""
+    PATCH_COMMAND ${EXEC} git am --3way ${CMAKE_CURRENT_SOURCE_DIR}/brotli-*.patch
     CONFIGURE_COMMAND ${EXEC} cmake -H<SOURCE_DIR> -B<BINARY_DIR>
         -DCMAKE_INSTALL_PREFIX=${MINGW_INSTALL_PREFIX}
         -DCMAKE_TOOLCHAIN_FILE=${TOOLCHAIN_FILE}
-- 
2.41.0.windows.1

